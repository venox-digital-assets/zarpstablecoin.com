---
import Layout from '../layouts/Layout.astro';
import stats from '../data/stats.json';

const zarFormatter = new Intl.NumberFormat('en-ZA', {
  style: 'currency',
  currency: 'ZAR',
  minimumFractionDigits: 2,
  maximumFractionDigits: 2,
});

const numberFormatter = new Intl.NumberFormat('en-ZA', {
  style: 'decimal',
  minimumFractionDigits: 2,
  maximumFractionDigits: 2,
});

const intFormatter = new Intl.NumberFormat('en-ZA', {
  style: 'decimal',
  minimumFractionDigits: 0,
  maximumFractionDigits: 0,
});

const supply = stats.supply;
const reserves = stats.reserves;
const transactions = stats.transactions;
const collateralRatio = ((reserves / supply) * 100).toFixed(1);
const lastUpdated = new Date(stats.lastUpdated).toLocaleDateString('en-ZA', { day: 'numeric', month: 'long', year: 'numeric' });

// Chart Data Calculation
const chartData = stats.chart || [];
const prices = chartData.map(d => d[1]);
const minPrice = Math.min(...prices);
const maxPrice = Math.max(...prices);
const priceRange = maxPrice - minPrice;
const hasRenderableChart = chartData.length > 1;
const chartStatusMessage = stats.sources?.chart?.status === 'error'
  ? `CoinGecko chart unavailable: ${stats.sources?.chart?.message ?? 'temporary error'}`
  : 'Chart data is temporarily unavailable.';

// SVG ViewBox 300x100
const chartPoints = hasRenderableChart
  ? chartData.map((d, i) => {
      const x = (i / Math.max(chartData.length - 1, 1)) * 300;
      const y = priceRange === 0 ? 50 : 100 - ((d[1] - minPrice) / priceRange) * 100;
      return `${x},${y}`;
    }).join(' ')
  : '';

const explorers = [
  { name: 'Base', url: 'https://basescan.org/token/0xb755506531786C8aC63B756BaB1ac387bACB0C04', logo: '/img/base.svg' },
  { name: 'Ethereum', url: 'https://etherscan.io/token/0xb755506531786C8aC63B756BaB1ac387bACB0C04', logo: '/img/ethereum.svg' },
  { name: 'Polygon', url: 'https://polygonscan.com/token/0xb755506531786C8aC63B756BaB1ac387bACB0C04', logo: '/img/polygon.svg' },
  { name: 'Solana', url: 'https://solscan.io/token/dngKhBQM3BGvsDHKhrLnjvRKfY5Q7gEnYGToj9Lk8rk', logo: '/img/solana.svg' },
];
---

<Layout title="Transparency | ZARP Stablecoin">
  <main class="min-h-screen bg-white pt-24 pb-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

      <!-- Header -->
      <div class="text-center mb-16">
        <h1 class="text-4xl md:text-5xl font-extrabold text-slate-900 tracking-tight mb-4">
          Transparency & <span class="text-[#009A35]">Trust</span>
        </h1>
        <p class="text-xl text-slate-500 max-w-3xl mx-auto">
          One ZARP is always redeemable for one Rand. Never more, never less. We earn trust through radical transparency.
        </p>
        <p class="text-sm text-slate-400 mt-4">Last updated: {lastUpdated}</p>
      </div>

      <!-- Key Metrics Grid -->
      <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-16">
        
        <!-- Circulating Supply -->
        <div class="bg-white rounded-2xl border border-slate-100 shadow-sm p-6">
          <p class="text-sm font-medium text-slate-500 mb-2">Circulating Supply</p>
          <p class="text-3xl font-extrabold text-slate-900">{numberFormatter.format(supply)}</p>
          <p class="text-xs text-slate-400 mt-2">ZARP tokens across all chains</p>
        </div>

        <!-- Treasury Reserves -->
        <div class="bg-white rounded-2xl border border-slate-100 shadow-sm p-6">
          <p class="text-sm font-medium text-slate-500 mb-2">Treasury Reserves</p>
          <p class="text-3xl font-extrabold text-[#009A35]">{zarFormatter.format(reserves)}</p>
          <p class="text-xs text-slate-400 mt-2">Held by Old Mutual Wealth</p>
        </div>

        <!-- Collateral Ratio -->
        <div class="bg-white rounded-2xl border border-slate-100 shadow-sm p-6">
          <p class="text-sm font-medium text-slate-500 mb-2">Collateral Ratio</p>
          <p class="text-3xl font-extrabold text-slate-900">{collateralRatio}%</p>
          <p class="text-xs text-slate-400 mt-2">Reserves ÷ Supply</p>
        </div>

        <!-- Total Transactions -->
        <div class="bg-white rounded-2xl border border-slate-100 shadow-sm p-6">
          <p class="text-sm font-medium text-slate-500 mb-2">Total Transactions</p>
          <p class="text-3xl font-extrabold text-slate-900">{intFormatter.format(transactions)}+</p>
          <p class="text-xs text-slate-400 mt-2">Lifetime on-chain transfers</p>
        </div>

      </div>

      <!-- How It Works -->
      <div class="bg-[#f3f6f4] rounded-2xl p-8 md:p-12 mb-16">
        <h2 class="text-2xl font-bold text-slate-900 mb-6">How ZARP Maintains Its Peg</h2>
        <div class="grid md:grid-cols-3 gap-8">
          <div>
            <div class="w-10 h-10 bg-[#009A35]/15 rounded-lg flex items-center justify-center mb-4">
              <span class="text-[#009A35] font-bold text-lg">1</span>
            </div>
            <h3 class="font-bold text-slate-900 mb-2">Minting</h3>
            <p class="text-sm text-slate-500">When issuing partners buy ZARP, new tokens are minted and an equal amount of rands is deposited into the treasury. Supply never exceeds reserves.</p>
          </div>
          <div>
            <div class="w-10 h-10 bg-[#009A35]/15 rounded-lg flex items-center justify-center mb-4">
              <span class="text-[#009A35] font-bold text-lg">2</span>
            </div>
            <h3 class="font-bold text-slate-900 mb-2">Redemption</h3>
            <p class="text-sm text-slate-500">When ZARP is redeemed, the tokens are burned and an equal amount of rands is released from the treasury. Always 1:1.</p>
          </div>
          <div>
            <div class="w-10 h-10 bg-[#009A35]/15 rounded-lg flex items-center justify-center mb-4">
              <span class="text-[#009A35] font-bold text-lg">3</span>
            </div>
            <h3 class="font-bold text-slate-900 mb-2">Verification</h3>
            <p class="text-sm text-slate-500">Independent auditors at Kempen Audit verify reserves and circulating supply to ensure ZARP's management assertions hold true.</p>
          </div>
        </div>
      </div>

      <!-- Two-column: Attestation + Standards -->
      <div class="grid md:grid-cols-2 gap-6 mb-16">
        
        <!-- Attestation Reports -->
        <div class="bg-white rounded-2xl border border-slate-100 shadow-sm p-8">
          <h3 class="text-lg font-bold text-slate-900 mb-3">Attestation Reports</h3>
          <p class="text-sm text-slate-500 mb-5">
            Independent auditors at Kempen Audit review our treasury reserves and circulating token supplies directly to ensure that ZARP Stablecoin's management assertions are verified.
          </p>
          <a href="https://kempengroup.co.za/wp-content/uploads/2025/09/ZARP-Stablecoin-Pty-Ltd-Agreed-upon-procedures-report-2025-09-04-1757061801998.pdf" target="_blank" rel="noopener" class="inline-flex items-center text-sm font-medium text-[#009A35] hover:underline">
            Read latest attestation report
            <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>
          </a>
          <div class="mt-6 pt-6 border-t border-slate-100">
            <img src="/img/kempen.svg" alt="Kempen Audit" class="h-8 w-auto opacity-70" />
          </div>
        </div>

        <!-- Stablecoin Standard -->
        <div class="bg-white rounded-2xl border border-slate-100 shadow-sm p-8">
          <h3 class="text-lg font-bold text-slate-900 mb-3">Committed to Best Practices</h3>
          <p class="text-sm text-slate-500 mb-5">
            ZARP Stablecoin is a proud member of the Stablecoin Standard, an industry body for stablecoin issuers globally that signifies compliance with industry standards.
          </p>
          <a href="https://stablecoinstandard.com/" target="_blank" rel="noopener" class="inline-flex items-center text-sm font-medium text-[#009A35] hover:underline">
            Visit Stablecoin Standard
            <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>
          </a>
          <div class="mt-6 pt-6 border-t border-slate-100 flex items-center gap-6">
            <img src="/img/old-mutual.svg" alt="Old Mutual Wealth" class="h-8 w-auto opacity-70" />
            <img src="/img/solidity-finance.svg" alt="Solidity Finance" class="h-8 w-auto opacity-70" />
          </div>
        </div>

      </div>

      <!-- Block Explorers -->
      <div id="explorers" class="mb-16">
        <h2 class="text-2xl font-bold text-slate-900 mb-2">Verify On-Chain</h2>
        <p class="text-slate-500 mb-8">ZARP token contracts are open and verifiable on every supported blockchain.</p>
        <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-4">
          {explorers.map((chain) => (
            <a href={chain.url} target="_blank" rel="noopener noreferrer" class="group flex items-center gap-4 bg-slate-50 hover:bg-white rounded-xl border border-slate-100 hover:border-[#009A35]/20 hover:shadow-md p-5 transition-all duration-300">
              <img src={chain.logo} alt={chain.name} class="h-8 w-auto" />
              <svg class="w-4 h-4 text-slate-300 group-hover:text-[#009A35] transition-colors ml-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>
            </a>
          ))}
        </div>
      </div>

      <!-- Third Party Data -->
      <div class="bg-white rounded-2xl border border-slate-100 shadow-sm p-8 md:p-12 mb-16">
        <div class="grid md:grid-cols-2 gap-12 items-center">
          <div>
            <h2 class="text-2xl font-bold text-slate-900 mb-4">Data that not even we can mess with</h2>
            <p class="text-slate-500 mb-6 leading-relaxed">
              ZARP is a true, crypto-native stablecoin on public ledgers with immutable data, aggregated through independent third parties like CoinGecko. We don't control the data — the blockchain does.
            </p>
            <a href="https://www.coingecko.com/en/coins/zarp-stablecoin" target="_blank" rel="noopener" class="inline-flex items-center gap-2 text-[#009A35] font-medium hover:underline">
              View on CoinGecko
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>
            </a>
          </div>
          <div class="bg-slate-50 rounded-xl p-6 border border-slate-100 flex flex-col items-center justify-center text-center">
            <img src="https://static.coingecko.com/s/coingecko-logo-8903d34ce19ca4be1c81f0db30e924154750d208683fad7ae6f2ce06c76d0a56.png" alt="CoinGecko" class="h-10 w-auto mb-4" />
            <div class="text-sm text-slate-400">Live Market Data</div>
            <div class="text-2xl font-bold text-slate-900 mt-1">ZARP / USD</div>
            
            <!-- Custom Sparkline Chart -->
            <div class="mt-6 w-full h-32 bg-white rounded-lg border border-slate-100 overflow-hidden relative group">
               {hasRenderableChart ? (
                 <svg viewBox="0 0 300 100" class="w-full h-full" preserveAspectRatio="none">
                   <!-- Gradient Fill -->
                   <defs>
                     <linearGradient id="chartGradient" x1="0" x2="0" y1="0" y2="1">
                       <stop offset="0%" stop-color="#009A35" stop-opacity="0.2"/>
                       <stop offset="100%" stop-color="#009A35" stop-opacity="0"/>
                     </linearGradient>
                   </defs>
                   <!-- Area -->
                   <path d={`M0,100 L${chartPoints} L300,100 Z`} fill="url(#chartGradient)" />
                   <!-- Line -->
                   <polyline points={chartPoints} fill="none" stroke="#009A35" stroke-width="2" vector-effect="non-scaling-stroke" />
                 </svg>
               ) : (
                 <div class="flex items-center justify-center h-full text-xs text-slate-400 px-4 text-center">{chartStatusMessage}</div>
               )}
               
               <!-- Hover tooltip (simple CSS) -->
               <div class="absolute top-2 right-2 text-[10px] bg-slate-900 text-white px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity">
                 7 Day Trend
               </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Contract Addresses -->
      <div class="bg-slate-900 rounded-2xl p-8 md:p-12">
        <h2 class="text-xl font-bold text-white mb-6">Contract Addresses</h2>
        <div class="space-y-4">
          <div class="flex flex-col sm:flex-row sm:items-center gap-2">
            <span class="text-sm font-medium text-slate-400 w-24">Base</span>
            <code class="text-sm text-emerald-400 bg-slate-800 px-3 py-1.5 rounded-lg font-mono break-all">0xb755506531786C8aC63B756BaB1ac387bACB0C04</code>
          </div>
          <div class="flex flex-col sm:flex-row sm:items-center gap-2">
            <span class="text-sm font-medium text-slate-400 w-24">Ethereum</span>
            <code class="text-sm text-emerald-400 bg-slate-800 px-3 py-1.5 rounded-lg font-mono break-all">0xb755506531786C8aC63B756BaB1ac387bACB0C04</code>
          </div>
          <div class="flex flex-col sm:flex-row sm:items-center gap-2">
            <span class="text-sm font-medium text-slate-400 w-24">Polygon</span>
            <code class="text-sm text-emerald-400 bg-slate-800 px-3 py-1.5 rounded-lg font-mono break-all">0xb755506531786C8aC63B756BaB1ac387bACB0C04</code>
          </div>
          <div class="flex flex-col sm:flex-row sm:items-center gap-2">
            <span class="text-sm font-medium text-slate-400 w-24">Solana</span>
            <code class="text-sm text-emerald-400 bg-slate-800 px-3 py-1.5 rounded-lg font-mono break-all">dngKhBQM3BGvsDHKhrLnjvRKfY5Q7gEnYGToj9Lk8rk</code>
          </div>
        </div>
      </div>

    </div>
  </main>
</Layout>
